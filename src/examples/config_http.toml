# Exemple de configuration HTTP destinée aux LAN / environnements de tests.
# ⚠️ En production, active HTTPS via [web.tls] ou un reverse-proxy qui termine TLS.
# Ce fichier force un cookie de session non Secure pour simplifier les tests locaux.

[runtime]
rust_log = "info,describe_me=debug"
# state_dir = "/var/lib/describe-me"

[runtime.cli]
web = "0.0.0.0:8080"
with_services = true
web_allow_ip = ["127.0.0.1", "::1", "192.168.1.0/24"]

[services]
include = ["ssh.service", "cron.service"]

[exposure]
expose_hostname = true
expose_os = true
expose_kernel = true
expose_services = true
expose_disk_partitions = true
expose_listening_sockets = true
expose_network_traffic = true
expose_updates = true
redacted = true

[web]
# IMPORTANT : remplace la chaine ci-dessous par l'empreinte générée via
#   describe-me --hash-web-token 'TonJetonUltraSecret'
token = "$argon2id$v=19$m=131072,t=4,p=1$x1V+ijOhRvklcO5gr4NS8g$ZZ3Ra67H3ijudkXg0rxbKYrvCnZpsTvSAjzmd7vjvlY"
allow_ips = ["127.0.0.1", "::1", "192.168.1.0/24"]
allow_origins = ["http://localhost:8080", "http://192.168.1.36:8080"]
logo_path = "/home/max/Documents/Projets/Rust/describe_me/src/application/web/assets/gen.svg"
# Cookie describe_me_session sans Secure (dev HTTP uniquement) :
dev_insecure_session_cookie = true

[web.exposure]
expose_hostname = true
expose_os = true
expose_kernel = true
expose_services = true
expose_disk_partitions = true
expose_listening_sockets = true
expose_network_traffic = true
expose_updates = true
redacted = true

# Pour activer HTTPS natif, ajoutez un bloc [web.tls] :
# [web.tls]
# cert_path = "/etc/describe-me/certs/server.pem"
# key_path = "/etc/describe-me/certs/server-key.pem"
# Si vous terminez TLS via un proxy (Caddy/Nginx/Traefik), déclarez son origin exact
# dans allow_origins et son IP dans trusted_proxies.

[web.security]
allowlist_multiplier = 2
token_ip_affinity_limit = 2

[web.security.html]
window_seconds = 60
per_ip = 40
per_token = 12

[web.security.sse]
window_seconds = 60
per_ip = 15
per_token = 10
max_active_per_ip = 2
max_active_per_token = 2
max_stream_seconds = 600
min_event_interval_ms = 500
max_payload_bytes = 98304

[web.security.brute_force]
window_seconds = 600
threshold = 5
initial_backoff_seconds = 10
backoff_multiplier = 2.0
backoff_ceiling_seconds = 120
quarantine_seconds = 3600
token_failure_threshold = 12
token_ip_spread = 2
sse_min_retry_seconds = 2
